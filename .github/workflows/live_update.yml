name: Bahn Update Loop
on:
  workflow_dispatch: # Erlaubt manuellen Start
  watch:             # Startet, wenn du das Repository "sternst" (Star)
  push:              # Startet bei jeder Code-Änderung

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install Dependencies
        run: pip install requests

      - name: Run 20 Minute Loop
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          
          # Die Schleife läuft 20 Mal (20 Minuten lang jede Minute)
          for i in {1..20}
          do
            python bot.py
            if [[ -n $(git status -s daten.json) ]]; then
              git add daten.json
              git commit -m "Update Zerbst $i"
              git push
            fi
            sleep 60
          done

      - name: Restart Workflow
        # Dieser Befehl triggert den Workflow nach Ende sofort wieder neu
        run: |
          curl -X POST -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
          -H "Accept: application/vnd.github.v3+json" \
          https://api.github.com/repos/${{ github.repository }}/actions/workflows/bahn.yml/dispatches \
          -d '{"ref":"main"}'
