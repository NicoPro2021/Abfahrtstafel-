<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DB Abfahrt Zerbst</title>
    <style>
        body { background-color: #000; color: #fff; font-family: Arial, sans-serif; margin: 0; }
        .header { background-color: #003399; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .uhrzeit { color: #ffcc00; font-size: 24px; font-weight: bold; }
        .tafel { width: 100%; border-collapse: collapse; }
        .zug-zeile { border-bottom: 1px solid #333; height: 80px; }
        .zeit { color: #ffcc00; font-size: 26px; font-weight: bold; padding-left: 15px; width: 80px; }
        .linie-box { background-color: #fff; color: #003399; padding: 3px 6px; font-weight: bold; border-radius: 2px; }
        .ziel { font-size: 24px; font-weight: bold; padding-left: 10px; }
        .gleis { color: #ffcc00; font-size: 26px; font-weight: bold; text-align: right; padding-right: 20px; }
        .info-text { color: #ff0000; font-size: 18px; font-weight: bold; }
        .puenktlich { color: #00ff00; font-size: 14px; }
    </style>
</head>
<body>

<div class="header">
    <h1>Zerbst/Anhalt</h1>
    <div id="uhr" class="uhrzeit">00:00:00</div>
</div>

<table class="tafel" id="fahrplan"></table>

<script>
    function updateUhr() {
        document.getElementById('uhr').innerText = new Date().toLocaleTimeString('de-DE');
    }
    setInterval(updateUhr, 1000);

    async function ladeDaten() {
        try {
            const res = await fetch('daten.json?v=' + Date.now());
            const zuege = await res.json();
            const liste = document.getElementById('fahrplan');
            const jetzt = new Date();
            const jetztZeitString = jetzt.getHours().toString().padStart(2, '0') + ":" + jetzt.getMinutes().toString().padStart(2, '0');

            liste.innerHTML = '';

            zuege.forEach(z => {
                // RÜCKSTAU-FILTER: Wenn die echte_zeit älter als jetzt ist, Zeile überspringen
                if (z.echte_zeit < jetztZeitString) return;

                const tr = document.createElement('tr');
                tr.className = 'zug-zeile';
                tr.innerHTML = `
                    <td class="zeit">${z.zeit}</td>
                    <td>
                        <span class="linie-box">${z.linie}</span>
                        <span class="ziel">${z.ziel}</span>
                        <br>
                        <span class="info-text">${z.info ? 'Heute ca. ' + z.echte_zeit + ' (' + z.info + ')' : ''}</span>
                    </td>
                    <td class="gleis">${z.gleis}</td>
                `;
                liste.appendChild(tr);
            });
        } catch (e) { console.log("Lade..."); }
    }

    ladeDaten();
    setInterval(ladeDaten, 30000); // Alle 30 Sek. checken
</script>
</body>
</html>
